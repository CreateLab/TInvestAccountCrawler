# TInvestAccountCrawler

Утилита для генерации CSV-файлов с информацией о содержимом портфеля через API Tinkoff Invest.

## Основная задача

* Выгрузка позиций портфеля пользователя и сохранение их в CSV-файлы.

## Возможности

* Подключение к API Tinkoff Invest по токену.
* Получение списка счетов пользователя.
* Подсчет ключевых параметров по каждому инструменту (количество, средняя цена, текущая цена, стоимость, прибыль).
* Формирование и сохранение CSV-файлов с подробной информацией о портфеле.

## Пример вывода

````plaintext
Счет: 0000000001 (Основной счёт)
  Стоимость позиций: 45 321,78 RUB
  Доступно наличных: 500,50 RUB
  → Файл сохранён: ./output/0000000001_Основной_13.05.2025.csv
------------------------------------------------------------
Счет: 0000000002 (Инвестиционный)
  Стоимость позиций: 10 987,65 RUB
  Доступно наличных: неизвестно
  → Файл сохранён: ./output/0000000002_Инвестиционный_13.05.2025.csv
------------------------------------------------------------
Счет: 0000000003 (Накопительный)
  Стоимость позиций: 2 345,00 RUB
  Доступно наличных: 100,10 RUB
  → Файл сохранён: ./output/0000000003_Накопительный_13.05.2025.csv
------------------------------------------------------------
````

## Требования

* .NET 8.0 SDK или выше
* Токен API Tinkoff Invest (получить в личном кабинете Тинькофф Инвестиций)
* Пакеты NuGet:

    * `Tinkoff.InvestApi` версии `0.6.16`
    * `CsvHelper` версии `33.0.1`

## Установка

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/yourusername/TInvestAccountCrawler.git
   cd TInvestAccountCrawler
   ```
2. Восстановите зависимости:

   ```bash
   dotnet restore
   ```

## Использование

Запустите утилиту командой:

```bash
dotnet run -- <API_TOKEN> [<путь_к_папке>]
```

* `<API_TOKEN>` – ваш токен доступа к Tinkoff Invest API.
* `[<путь_к_папке>]` – опциональный путь для сохранения CSV-файлов (по умолчанию текущая директория).

Пример запуска:

```bash
dotnet run -- eyJhbGciOiJIUzI1NiI... ./output
```

После выполнения в указанной папке появятся CSV-файлы с данными по каждому счету:

```
<AccountId>_<AccountName>_13.05.2025.csv
```

## Структура проекта

```
TInvestAccountCrawler/
├── Program.cs            # Точка входа и разбор аргументов
├── Services/
│   └── PortfolioCrawler.cs  # Логика получения данных и генерации CSV
├── Models/
│   └── PositionRecord.cs    # Модель записи для CSV
├── Helpers/
│   └── DecimalExtensions.cs # Конвертация Quotation и MoneyValue в decimal
└── TInvestAccountCrawler.csproj
```

